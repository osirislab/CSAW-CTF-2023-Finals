#version 300 es
// Oh no, I spilled my shader all over the floor!
precision highp float;precision lowp usampler2D;precision highp int;in vec3 position,normal;in vec2 texCoord;uniform mat4 modelViewMatrix,projectionMatrix;uniform mat3 normalMatrix;uniform usampler2D t_sampler;uniform ivec2 u_texRes;uniform int[4] u_key;out vec3 v_pos,v_normal;out vec4 v_colour;const vec3 v=vec3(.92,.92,2);const vec2 m=vec2(40,25);mat4 t(vec3 u){mat4 v;v[0][0]=1.;v[1][1]=1.;v[2][2]=1.;v[3]=vec4(u,1);return v;}vec4 h(uvec4 u){vec4 v;v.xyz=vec3(u)/255.;v.xyz=pow(v.xyz,vec3(2.2));v.w=float(u.w)/255.;return v;}uvec4 h(uvec4 u,uvec4 v){uint t=u.y+(u.x<<8),i=u.w+(u.z<<8),n=(t<<4&65535u)+(uint(u_key[2])&255u)&65535u,w=t+40503u&65535u,z=(t>>5&2047u)+uint(u_key[3])&65535u;i=i-(n^w^z)&65535u;uint m=(i<<4&65535u)+(uint(u_key[0])&255u)&65535u,f=i+40503u&65535u,l=(i>>5&2047u)+uint(u_key[1])&65535u;t=t-(m^f^l)&65535u;uvec4 r;r.y=t&255u^v.y;r.x=t>>8^v.x;r.w=i&255u^v.w;r.z=i>>8^v.z;return r;}void main(){ivec2 u=ivec2(texCoord);uvec4 i=texelFetch(t_sampler,u,0),r=texelFetch(t_sampler,u+ivec2(1,0),0);ivec2 m=textureSize(t_sampler,0);int n=u.x+u.y*m.x;uvec4 l;l=n==0?uvec4(18u,52u,86u,120u):texelFetch(t_sampler,ivec2((n-1)%m.x,floor(float(n-1)/float(m.y))),0);r=h(r,i);i=h(i,l);v_colour=h(i);v_colour.w=1.;mat4 w=t((vec4(r).xyz-vec3(127))*.1);vec4 x=modelViewMatrix*w*vec4(position*v*.1,1);v_pos=x.xyz/x.w;v_normal=normalize(normalMatrix*normal);gl_Position=projectionMatrix*x;}
